---
title: "Math 23C Term Project"
author: "Robi Rahman and Sharon Tai"
date: "24 March - 14 May 2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(eeptools) # to import the decomma() function
library(boot)
library(caret)
library(psych)
```

## Question

Can the price changes in certain commodities reveal the kind of recession the U.S. is in? How do
qualitatively different recessions affect commodities’ prices? We are specifically interested in the
dotcom crash of the early 2000s, the Great Recession, and the COVID-19 pandemic. 


## Motivation

“The stock market is not the economy.” This refrain frequently sounds. We have decided to assess
whether commodity prices that could signal the health of the general public correlated with
unemployment rates across two decades. The three significant recessions in this time period affected
different populations differently. Could the differences in commodity prices signal which populations
were significantly affected, and how affected they were? Are there differences in how each type of
recession affects them?

In general, the risk-adjusted long-run expected returns to all publicly traded assets are the same
throughout the economy. If one commodity had a higher expected return than another, traders would
sell the less profitable asset and buy the more profitable one, until the costs of each are proportionate
to their future returns. The best null hypothesis for changes in asset prices is that all of them
(specifically all the ones that are equally risky) will rise or fall by the same amount, all other factors
equal.

However, different goods change in value differently in relation to different world events, and some
commodities are correlated with other ones. We have selected a list of commodities that we 
hypothesize will behave differently during qualitatively different recessions. Did some of the selected
commodities respond differently to these qualitatively different recessions?

Auxiliary questions we’ll be considering are
1. What the price signals about the good and its consumers
2. Whether there were supply and demand shocks that affected the prices


## Hypothesis

\textbf{Pre-register our hypotheses here!}




## Analysis - Robi



```{r}
commodity_prices <- read.csv("source_data/commodities data.csv")
recession_dates <- read.csv("source_data/monthly recession indicator.csv")

recession_dates <- recession_dates[c(-242),] # Removed the entry for March 2021 so that the datasets have congruent date ranges.
commodity_prices[,9] <- decomma(commodity_prices[,9]) # Remove commas from the price of gold column.

goods <- c("Month","Crude_oil", "Sugar", "Soybeans", "Wheat", "Beef", "Rubber", "Cocoa_beans", "Gold", "USD_EUR", "Ice_cream", "Unemployment")
names(commodity_prices) <- goods


# Adding a column to distinguish the three different recessions in our date range.
recession_dates$which_recession <- recession_dates$USREC
recession_dates[84:101,3] <- 2*recession_dates[84:101,3]
recession_dates[230:241,3] <- 3*recession_dates[230:241,3]

# Find month-over-month price changes for each commodity
price_changes <- commodity_prices
for (c in 2:11) {
  for (r in 2:241) {
    price_changes[r,c] <- commodity_prices[r,c] / commodity_prices[r-1,c] - 1
  }
}
price_changes$recession_bool <- recession_dates$USREC
price_changes$which_recession <- recession_dates$which_recession
price_changes <- price_changes[c(-1),]

# Display a histogram of the price changes
for (i in 2:11) {
  name <- goods[i]
  hist(price_changes[,i], main=name)
}

# Repeating that, but during recessions only
for (i in 2:11) {
  name <- paste(goods[i],"(recession)")
  values <- price_changes[,c(i,13)]
  values <- values[values[,2] == 1,]
  hist(values[,1], main=name)
}

# Repeat for months not in recession
for (i in 2:11) {
  name <- paste(goods[i],"(non-recession)")
  values <- price_changes[,c(i,13)]
  values <- values[values[,2] == 0,]
  hist(values[,1], main=name)
}
```



```{r}
soybeans_regression <- glm(recession_bool ~ Soybeans, data = price_changes, family = 'binomial')
summary(soybeans_regression)
plot(price_changes$Soybeans, price_changes$recession_bool)


gold_regression <- glm(recession_bool ~ Gold, data = price_changes, family = 'binomial')
summary(gold_regression)
plot(price_changes$Gold, price_changes$recession_bool)


goods_vs_recession_logistic_model <- glm(
  recession_bool ~ Crude_oil + Sugar + Soybeans + Wheat + Beef + Rubber + Cocoa_beans + Gold + USD_EUR + Ice_cream,
  data = price_changes, family = 'binomial')
summary(goods_vs_recession_logistic_model)

negative_goods_regression <- glm(recession_bool ~ Crude_oil + Wheat + Rubber + Ice_cream, data = price_changes, family = 'binomial')
summary(negative_goods_regression)
# Probability of a recession if all of these goods lost 100% of their value this month:
inv.logit(-1.6582+0.2640+0.7643+0.8586+1.5616)
# Probability of a recession if all of these goods doubled in price last month:
inv.logit(-1.6582-0.2640-0.7643-0.8586-1.5616)

icecream_regression <- glm(recession_bool ~ Ice_cream, data = price_changes, family = 'binomial')
summary(icecream_regression)

plot(price_changes$Ice_cream, price_changes$recession_bool)
curve(inv.logit(-1.5900*x-1.6687), add=TRUE)


icecream_predictions <- as.factor(predict(icecream_regression, newdata=price_changes, type='response') > inv.logit(-1.6687))
confusionMatrix(icecream_predictions, reference = as.factor(price_changes$recession_bool==1))


recession_predictions <- as.factor(predict(goods_vs_recession_logistic_model, newdata=price_changes, type='response') > inv.logit(-1.7006))
confusionMatrix(recession_predictions, reference = as.factor(price_changes$recession_bool==1))
```



It looks like there's not much of a correlation between recessions and positive
vs negative price changes of goods. Let's investigate using a contingency table.

```{r}
# unpack the dataframe price_changes into two columns
change_vs_recession <- data.frame(change=numeric(2400),recession_bool=rep(price_changes$recession_bool,10))

for (c in 2:11) {
  for (r in 2:241) {
    change_vs_recession[r-1+240*(c-2),1] <- price_changes[r-1,c]
  }
}

hist(change_vs_recession$change)
table(change_vs_recession$change >= 0, change_vs_recession$recession_bool)

# During recessions: price diff >= 0 212 times; price diff < 0 168 times
# During other times: price diff >= 0 1130 times; price diff < 0 890 times

212/(212+168) # Price goes up 55.8% of the time during recessions
1130/(1130+890) # Price goes up 55.9% of the time without recession

# price_changes_in_recession <- c()
# price_changes_no_recession <- c()
```








Make a graphical display to see if any commodities are correlated to each other.

```{r}
pairs.panels(price_changes[,2:13])
```























---------------



## Distribution Analysis - Sharon

```{r}

```
## Comparison Across Goods

# Prices
During the two decades...the first half and second half...
The effects during a recession...achieved more granularity by using daily data.

# Price Changes
Using daily data

# Difference in Price Changes
Using daily data









